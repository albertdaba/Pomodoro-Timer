<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pomodoro Timer – Bankable Breaks + Continuous + NO UI</title>
<style>
  :root{
    --bg:#0f1320;
    --fg:#e8ecf1;
    --accent:#4da3ff;
    --accent-2:#39d98a;
    --danger:#ff6b6b;
    --muted:#9aa7b2;
    --card:#171c2b;
    --bar:#23304a;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    display:flex;min-height:100vh;align-items:center;justify-content:center;padding:24px;
  }
  .app{
    width:100%;max-width:780px;background:var(--card);
    border:1px solid rgba(255,255,255,0.06);border-radius:16px;padding:20px;
    box-shadow:0 10px 30px rgba(0,0,0,0.35);
  }
  h1{margin:0 0 10px;font-size:20px;font-weight:700;letter-spacing:.2px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
  label{display:block;font-size:13px;color:var(--muted);margin:0 0 6px}
  input[type="number"]{
    width:140px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);
    background:#0f1422;color:var(--fg);font-size:16px;outline:none;
  }
  .spacer{flex:1}
  .stats{
    display:flex;gap:16px;align-items:center;flex-wrap:wrap;
    background:#0f1422;border:1px solid rgba(255,255,255,0.06);
    padding:10px 12px;border-radius:12px;
  }
  .pill{font-size:13px;padding:6px 10px;border-radius:999px;background:#0e1a2d;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .pill strong{color:var(--fg)}
  .toggles{margin-top:10px}
  .toggle-box{
    display:flex;align-items:center;gap:8px;background:#0f1422;border:1px solid rgba(255,255,255,0.06);
    padding:8px 10px;border-radius:10px;font-size:13px;color:var(--muted)
  }
  .buttons{display:flex;gap:10px;flex-wrap:wrap}
  button{
    cursor:pointer;border:none;border-radius:10px;padding:10px 14px;
    font-size:15px;font-weight:600;letter-spacing:.2px;color:#061220;background:var(--accent);
  }
  button.secondary{background:#26334f;color:var(--fg)}
  button.success{background:var(--accent-2)}
  button.danger{background:var(--danger);color:#fff}
  button:disabled{opacity:.55;cursor:not-allowed}
  .timer{
    margin:16px 0 8px;background:#0f1422;border:1px solid rgba(255,255,255,0.06);
    border-radius:12px;padding:16px;
  }
  .mode{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px;font-size:14px;color:var(--muted)}
  .mode strong{color:var(--fg)}
  .progress-wrap{width:100%;height:22px;background:var(--bar);border-radius:999px;overflow:hidden;position:relative}
  .progress{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,var(--accent),#7ab0ff);transition:width .2s linear}
  .time-readout{margin-top:10px;font-variant-numeric:tabular-nums;font-size:28px;font-weight:700}

  .todo{
    margin-top:18px;background:#0f1422;border:1px solid rgba(255,255,255,0.06);
    border-radius:12px;padding:12px 12px 4px;
  }
  .todo h2{margin:0 0 8px;font-size:16px}
  .todo-item{display:flex;align-items:center;gap:10px;padding:8px 6px;border-radius:8px}
  .todo-item:hover{background:#0d1626}
  .todo-item input[type="text"]{
    flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
    background:#0b1220;color:var(--fg);font-size:15px;
  }
  .footnote{margin-top:8px;color:var(--muted);font-size:12px}

  /* Alarm controls */
  .alarm-wrap{display:flex;gap:12px;align-items:flex-end;flex-wrap:wrap}
  .alarm-control{
    background:#0f1422;border:1px solid rgba(255,255,255,0.06);
    padding:10px 12px;border-radius:12px;display:flex;gap:12px;align-items:center
  }
  .alarm-control label{margin:0;font-size:13px}
  .alarm-control input[type="range"]{width:180px}

  /* NO UI mode */
  body.no-ui-active .hide-when-no-ui{display:none !important;}
  #noUiScreen{
    display:none; /* shown when body.no-ui-active */
    text-align:center;padding:12px 0;
  }
  body.no-ui-active #noUiScreen{display:block;}
  .no-ui-bar{display:flex;justify-content:flex-start}
  .back-btn{background:#26334f;color:var(--fg)}
  .ring-wrap{display:flex;justify-content:center;align-items:center;margin:16px 0}
  .ring-time{position:absolute;font-size:32px;font-weight:800;letter-spacing:.5px}
  .ring-phase{margin-top:6px;color:var(--muted);font-size:14px}
  .ring-box{position:relative;width:240px;height:240px}
  .ring-svg{transform:rotate(-90deg)}
  .ring-bg{opacity:.25}
  .ring-fg{transition:stroke-dashoffset .3s linear}
  /* In NO UI, show tasks right under the ring; reuse same .todo but simplify look */
  body.no-ui-active .todo{background:transparent;border-color:transparent}
</style>
</head>
<body>
  <div class="app">
    <!-- MAIN UI CONTENT -->
    <div id="mainUI" class="hide-when-no-ui">
      <h1>Pomodoro Productivity Timer</h1>

      <div class="row">
        <div>
          <label for="workMins">Productive time (minutes)</label>
          <input id="workMins" type="number" min="1" step="1" value="9">
        </div>
        <div>
          <label for="breakMins">Mini break time (minutes)</label>
          <input id="breakMins" type="number" min="1" step="1" value="3">
        </div>
        <div class="spacer"></div>
        <div class="stats">
          <div class="pill">Mode: <strong id="modeLabel">Idle</strong></div>
          <div class="pill">Banked break: <strong id="bankLabel">00:00</strong></div>
        </div>
      </div>

      <div class="row toggles">
        <div class="toggle-box">
          <input id="continuousToggle" type="checkbox">
          <label for="continuousToggle">Continuous mode (skip breaks & bank them)</label>
        </div>
        <div class="toggle-box">
          <input id="noUiToggle" type="checkbox">
          <label for="noUiToggle">NO UI mode</label>
        </div>
        <div class="spacer"></div>
        <div class="alarm-wrap">
          <div class="alarm-control">
            <label><input id="alarmToggle" type="checkbox" checked> Alarm</label>
            <label for="alarmVol">Volume</label>
            <input id="alarmVol" type="range" min="0" max="100" value="30">
            <span id="alarmVolLabel" class="pill">30%</span>
            <button id="testAlarmBtn" class="secondary">Test</button>
          </div>
        </div>
      </div>

      <div class="timer">
        <div class="mode">
          <div><span id="phaseText">—</span></div>
          <div class="buttons">
            <button id="startBtn">Start</button>
            <button id="startBankBtn" class="success" disabled>Start Break</button>
            <button id="cancelBreakBtn" class="danger" disabled>Cancel</button>
          </div>
        </div>
        <div class="progress-wrap" aria-label="progress">
          <div id="progress" class="progress"></div>
        </div>
        <div class="time-readout" id="timeReadout">00:00</div>
      </div>
    </div>

    <!-- NO UI MINIMAL SCREEN -->
    <div id="noUiScreen">
      <div class="no-ui-bar">
        <button id="backFromNoUi" class="back-btn">Back</button>
      </div>
      <div class="ring-wrap">
        <div class="ring-box">
          <svg class="ring-svg" width="240" height="240" viewBox="0 0 240 240">
            <!-- Circle geometry -->
            <circle class="ring-bg" cx="120" cy="120" r="100" stroke="#ffffff" stroke-width="16" fill="none" />
            <circle id="ringFg" class="ring-fg" cx="120" cy="120" r="100" stroke="#4da3ff" stroke-width="16" fill="none"
              stroke-linecap="round" stroke-dasharray="628.3185307179587" stroke-dashoffset="628.3185307179587" />
          </svg>
          <div id="ringTime" class="ring-time" style="top:50%;left:50%;transform:translate(-50%,-50%);">00:00</div>
        </div>
      </div>
      <div id="ringPhase" class="ring-phase">—</div>
    </div>

    <!-- Tasks (shown in both modes; in NO UI it sits under the ring) -->
    <div class="todo">
      <h2>Quick To-Do (3 items)</h2>
      <div class="todo-item">
        <input type="checkbox" id="todo1">
        <input type="text" id="todo1text" placeholder="Task 1">
      </div>
      <div class="todo-item">
        <input type="checkbox" id="todo2">
        <input type="text" id="todo2text" placeholder="Task 2">
      </div>
      <div class="todo-item">
        <input type="checkbox" id="todo3">
        <input type="text" id="todo3text" placeholder="Task 3">
      </div>
      <div class="footnote">Tip: Bank time by skipping or canceling breaks. Spend it anytime with “Start Break”.</div>
    </div>
  </div>

<script>
(function(){
  // --- Elements ---
  const workInput = document.getElementById('workMins');
  const breakInput = document.getElementById('breakMins');
  const startBtn = document.getElementById('startBtn');
  const startBankBtn = document.getElementById('startBankBtn');
  const cancelBreakBtn = document.getElementById('cancelBreakBtn');
  const modeLabel = document.getElementById('modeLabel');
  const phaseText = document.getElementById('phaseText');
  const progressEl = document.getElementById('progress');
  const timeReadout = document.getElementById('timeReadout');
  const bankLabel = document.getElementById('bankLabel');

  const continuousToggle = document.getElementById('continuousToggle');
  const noUiToggle = document.getElementById('noUiToggle');
  const backFromNoUi = document.getElementById('backFromNoUi');
  const ringFg = document.getElementById('ringFg');
  const ringTime = document.getElementById('ringTime');
  const ringPhase = document.getElementById('ringPhase');

  // Alarm controls
  const alarmToggle = document.getElementById('alarmToggle');
  const alarmVol = document.getElementById('alarmVol');
  const alarmVolLabel = document.getElementById('alarmVolLabel');
  const testAlarmBtn = document.getElementById('testAlarmBtn');

  // --- State ---
  let state = 'idle';            // 'idle' | 'work' | 'break'
  let timerId = null;            // setInterval ID
  let phaseTotal = 0;            // seconds total of current phase
  let phaseRemaining = 0;        // seconds remaining of current phase
  let usingBank = false;         // whether current break is bank-spend
  let bankedSeconds = 0;         // accumulated unused break time (seconds)

  // --- Audio (Web Audio API) ---
  let audioCtx = null;
  function ensureAudioCtx(){
    if (!audioCtx) {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      audioCtx = new Ctx();
    }
  }
  function getVolume(){
    return Math.max(0, Math.min(1, parseInt(alarmVol.value||'30',10)/100));
  }
  function beep(freq=880, durationMs=250, vol=0.25, type='sine'){
    if (!alarmToggle.checked) return;
    ensureAudioCtx();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    gain.gain.value = vol;
    osc.connect(gain).connect(audioCtx.destination);
    const now = audioCtx.currentTime;
    gain.gain.setValueAtTime(0, now);
    gain.gain.linearRampToValueAtTime(vol, now + 0.01);
    gain.gain.linearRampToValueAtTime(0, now + durationMs/1000 - 0.02);
    osc.start(now);
    osc.stop(now + durationMs/1000);
  }
  function chimeBreakStart(){
    const v = getVolume();
    beep(880, 220, v, 'sine');
    setTimeout(()=>beep(660, 220, Math.max(0, v*0.9), 'sine'), 280);
  }
  function chimeWorkResume(){
    const v = getVolume();
    beep(520, 180, v, 'triangle');
  }

  // --- Utilities ---
  const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));
  const mmss = (secs) => {
    secs = Math.max(0, Math.floor(secs));
    const m = Math.floor(secs / 60);
    const s = secs % 60;
    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  };
  function setProgress(done, total){
    const pct = total <= 0 ? 0 : clamp((1 - (done/total)) * 100, 0, 100);
    progressEl.style.width = `${pct}%`;
  }
  function updateBankLabel(){
    bankLabel.textContent = mmss(bankedSeconds);
    // Bank can be taken in Idle or Work; disabled only if already on a break or no bank
    startBankBtn.disabled = !(bankedSeconds > 0 && state !== 'break');
  }
  function clearTimer(){
    if (timerId) { clearInterval(timerId); timerId = null; }
  }

  // --- NO UI ring updates ---
  const RADIUS = 100;
  const CIRC = 2 * Math.PI * RADIUS; // 628.3185...
  function updateRing(){
    // show current phase time & phase label
    ringTime.textContent = mmss(phaseRemaining);
    ringPhase.textContent = (state === 'work') ? 'Focus time' :
                            (state === 'break') ? (usingBank ? 'Banked break' : 'Mini break') : '—';
    // progress ring: remaining / total
    const frac = (phaseTotal > 0) ? (phaseRemaining / phaseTotal) : 0;
    const offset = CIRC * (1 - clamp(frac, 0, 1));
    ringFg.style.strokeDasharray = String(CIRC);
    ringFg.style.strokeDashoffset = String(offset);
  }

  // --- Mode handling ---
  function setMode(newMode){
    state = newMode;
    modeLabel.textContent = newMode.charAt(0).toUpperCase() + newMode.slice(1);
    if (state === 'idle'){
      phaseText.textContent = '—';
      timeReadout.textContent = '00:00';
      setProgress(0,1);
      startBtn.disabled = false;
      cancelBreakBtn.disabled = true;
    } else if (state === 'work'){
      phaseText.textContent = 'Focus time';
      startBtn.disabled = true;
      cancelBreakBtn.disabled = true;
    } else if (state === 'break'){
      phaseText.textContent = usingBank ? 'Banked break' : 'Mini break';
      startBtn.disabled = true;
      cancelBreakBtn.disabled = false;
    }
    updateBankLabel();
    updateRing();
  }

  // --- Phase control ---
  function startWork(fromBreak=false){
    usingBank = false;
    const mins = Math.max(1, parseInt(workInput.value || '0', 10));
    phaseTotal = mins * 60;
    phaseRemaining = phaseTotal;
    setMode('work');
    if (fromBreak) chimeWorkResume();
    tickStart(() => {
      // On work complete:
      const breakSecs = Math.max(1, parseInt(breakInput.value || '0', 10)) * 60;
      if (continuousToggle.checked){
        // Skip the break: bank it and start the next work immediately
        bankedSeconds += breakSecs;
        updateBankLabel();
        startWork(true);
      } else {
        startBreakAuto();
      }
    });
  }

  function startBreakAuto(){
    usingBank = false;
    const mins = Math.max(1, parseInt(breakInput.value || '0', 10));
    beginBreakFor(mins * 60);
  }

  // Banked break can be taken at any time (Idle or Work)
  function startBreakFromBank(){
    if (state === 'break' || bankedSeconds <= 0) return;
    usingBank = true;
    const use = bankedSeconds;        // spend all at once
    bankedSeconds = 0;                // deduct immediately
    updateBankLabel();
    beginBreakFor(use, /*wasBank*/true);
  }

  function beginBreakFor(seconds, wasBank=false){
    if (seconds <= 0){
      startWork(true);
      return;
    }
    phaseTotal = seconds;
    phaseRemaining = phaseTotal;
    setMode('break');
    chimeBreakStart();
    tickStart(() => {
      usingBank = false;
      setMode('work');
      startWork(true);
    }, wasBank);
  }

  function cancelBreak(){
    if (state !== 'break') return;
    // whatever remains goes back to the bank
    bankedSeconds += phaseRemaining;
    clearTimer();
    usingBank = false;
    updateBankLabel();
    startWork(true);
  }

  // --- Timer loop ---
  function tickStart(onComplete){
    clearTimer();
    renderTick();
    timerId = setInterval(() => {
      phaseRemaining -= 1;
      if (phaseRemaining <= 0){
        clearTimer();
        renderTick();
        onComplete && onComplete();
      } else {
        renderTick();
      }
    }, 1000);
  }

  function renderTick(){
    timeReadout.textContent = mmss(phaseRemaining);
    setProgress(phaseRemaining, phaseTotal);
    updateBankLabel();
    updateRing();
  }

  // --- Event bindings ---
  startBtn.addEventListener('click', () => {
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    if (state === 'idle') startWork(false);
  });

  // Start banked break anytime (Idle or Work)
  startBankBtn.addEventListener('click', () => {
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    if (bankedSeconds > 0 && state !== 'break') startBreakFromBank();
  });

  cancelBreakBtn.addEventListener('click', () => {
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    cancelBreak();
  });

  // Alarm UI
  testAlarmBtn.addEventListener('click', () => {
    ensureAudioCtx();
    if (audioCtx.state === 'suspended') audioCtx.resume();
    chimeBreakStart();
    setTimeout(chimeWorkResume, 700);
  });
  alarmVol.addEventListener('input', () => {
    alarmVolLabel.textContent = `${alarmVol.value}%`;
  });

  // Disable time inputs while a phase is running to avoid confusion
  function setInputsDisabled(disabled){
    workInput.disabled = disabled;
    breakInput.disabled = disabled;
  }
  const observer = new MutationObserver(() => {
    const running = state === 'work' || state === 'break';
    setInputsDisabled(running);
  });
  observer.observe(modeLabel, {childList:true});

  // NO UI toggle
  noUiToggle.addEventListener('change', () => {
    document.body.classList.toggle('no-ui-active', noUiToggle.checked);
    updateRing();
  });
  backFromNoUi.addEventListener('click', () => {
    noUiToggle.checked = false;
    document.body.classList.remove('no-ui-active');
  });

  // Initialize
  (function init(){
    // Pre-set ring geometry (already matches CSS constants)
    ringFg.style.strokeDasharray = String(2*Math.PI*100);
    ringFg.style.strokeDashoffset = String(2*Math.PI*100);

    setMode('idle');
    updateBankLabel();
    alarmVolLabel.textContent = `${alarmVol.value}%`;
    updateRing();
  })();
})();
</script>
</body>
</html>
